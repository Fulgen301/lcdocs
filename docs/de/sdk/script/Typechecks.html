<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<link rel="stylesheet" type="text/css" href="../../doku.css">
<title>Datentypen</title>
<?php 
  $g_page_language = 'german';
  require_once('../../../webnotes/core/api.php');
  pwn_head();
?><script type="text/javascript">
  function switchLanguage() {
    var loc = window.location.href;
    if (loc.match(/\/en\//)) loc = loc.replace(/\/en\//, "/de/");
    else loc = loc.replace(/\/de\//, "/en/");
    window.location = loc;
  }
</script>
</head>
<body>
<ul class="nav">
<li class="fineprint">Clonk Entwicklermodus Dokumentation</li>
<li class="switchlang"><a href="javascript:switchLanguage()"><img src="/deco/dco_en_sml.gif" alt="English" border="0"></a></li>
<li><a href="../../sdk/index.html">Einleitung</a></li>
<li><a href="../../content.html">Inhalt</a></li>
<li><a href="../../search.php">Suche</a></li>
<li><a href="../../sdk/console.html">Engine</a></li>
<li><a href="../../sdk/cmdline.html">Kommandozeile</a></li>
<li><a href="../../sdk/files.html">Spieldaten</a></li>
<li><a href="../../sdk/script/index.html">Script</a></li>
</ul>


<h1>Datentypen</h1>


	<div class="text">C4Script unterstützt die folgenden Datentypen für Variablen, Parameter und Rückgabewerte:</div>

	<div class="text"><table>
<thead><tr>
<th>Typname</th>
<th>Voller Name</th>
<th>Variableninhalt</th>
<th>Beispiel</th>
</tr></thead>
<tbody>
<tr>
<td><code>int</code></td>
<td>Integer</td>
<td>Eine ganze Zahl im Bereich von -2.147.483.648 bis +2.147.483.647.</td>
<td><code>42 </code></td>
</tr>
<tr class="dark">
<td><code>bool</code></td>
<td>Boolean</td>
<td>"wahr" (Wert <code>true</code>) oder "falsch" (Wert <code>false</code>). Wird von vielen Kontrollstrukturen wie <a href="../../sdk/script/fn/if.html">if</a> und <a href="../../sdk/script/fn/while.html">while</a> als Parameter erwartet.</td>
<td><code><b>true</b> </code></td>
</tr>
<tr>
<td><code>id</code></td>
<td>Definitions-ID</td>
<td>ID einer Objektdefinition (siehe <a href="../../sdk/definition/index.html#ObjektundEntwicklerIdentifikation">Objektdefinitionen</a>)</td>
<td><code>CLNK </code></td>
</tr>
<tr class="dark">
<td><code>string</code></td>
<td>Zeichenkette</td>
<td>Ein beliebiger Text. Ein einzelnes Zeichen des Strings als int lässt sich mit <a href="../../sdk/script/fn/GetChar.html">GetChar</a> extrahieren. Einzelne Zeichen eines Strings können als Ein-Zeichen-Strings mit <code><i class="string">"string"</i>[index]</code> extrahiert werden. Ändern von Strings ist damit nicht möglich. Ein negativer Index wird als Index vom String-Ende aus angesehen.</td>
<td><code><i class="string">"Dies ist ein Text!"</i> </code></td>
</tr>
<tr>
<td><code>object</code></td>
<td>Objektzeiger</td>
<td>Verweis auf ein im Spiel existierendes Objekt. Hat keine direkte Darstellung. Siehe z.B. <a href="../../sdk/script/fn/FindObject.html">FindObject</a>().
				Zugriff auf lokale Variablen ist mit <code>obj[<i class="string">"name"</i>]</code> oder <code>obj.name</code>, letzteres bei aktiviertem <code><b>#strict</b> 3</code>, möglich.</td>
<td>-</td>
</tr>
<tr class="dark">
<td><code>array</code></td>
<td>Feld</td>
<td>Ein Typ, der eine Reihe weiterer durchnummerierter Variablen enthält, deren Anzahl mit <a href="../../sdk/script/fn/GetLength.html">GetLength</a> abgefragt werden kann, und die mit <code><em>array</em>[<em>index</em>]</code> abgerufen werden können. Ab CR.</td>
<td><code>[0,42,CLNK] </code></td>
</tr>
<tr>
<td><code>map</code></td>
<td>Map</td>
<td>Ein Typ, der zu mehreren Schlüssel beliebigen Typs je eine Variable abspeichern kann. Mithilfe von <a href="../../sdk/script/fn/GetKeys.html">GetKeys</a> und <a href="../../sdk/script/fn/GetValues.html">GetValues</a> können die gesetzten Schlüssel bzw. Werte als Array ermittelt werden. Zugriff auf den Wert mit bestimmten Schlüssel erfolgt mit <code><em>map</em>[<em>key</em>]</code>. Zugriff auf Werte mit einem fest bestimmten String-Schlüssel der nur Identifier-Zeichen beinhaltet kann auch mit <code><em>map</em>.<em>key</em></code> erfolgen. Ab LC [334], nur mit <a href="../../sdk/script/Strict.html">#strict 3</a> oder höher.</td>
<td><code>{ X: 10, Y: 50 }</code></td>
</tr>
</tbody>
</table></div>

	<div class="text">Außerdem gibt es noch zwei spezielle Typen:</div>

	<div class="text"><ul>
	<li>
<code>any</code>: Der Typ ist nicht bekannt oder egal. "nil" hat immer diesen Typ.</li>
	<li>
<code>&amp;</code>: Der Wert ist eine Referenz - z.B. auf eine Variable. Er verhält sich genau wie der Zielwert, kann aber gesetzt werden (z.B. mit dem Operator "<code>=</code>"). Siehe auch <a href="../../sdk/script/Funcs.html#referenzen">Referenzparameter</a>.</li>
	</ul></div>

	<h2>Arrays</h2>
	
		<div class="text">Arrays können entweder direkt durch <code>[<em>Ausdruck 1</em>, <em>Ausdruck 2</em>, ...]</code> oder <a href="../../sdk/script/fn/CreateArray.html">CreateArray</a>() erstellt werden. Sie werden bei Zugriff auf ein Element gegebenenfalls automatisch verlängert, jedoch ist es schneller, das Array gleich mit der benötigten Länge zu erstellen. Wird ein Array einer Variablen zugewiesen oder einer Funktion übergeben, bekommt diese Variable eine eigene Kopie des Arrays. Das eigentliche Kopieren wird aber erst ausgeführt, wenn es nötig ist. Wenn das Array einer Funktion zum Ändern übergeben werden soll, muss ein Referenzparameter verwendet werden.
		</div>
		<div class="text">Zugriff auf ein Element <code>i</code> eines Arrays <code>a</code> erfolgt über <code>a[i]</code>. Dabei entspricht <code>i=0</code> dem ersten Element.</div>
		<div class="text">Elemente am Ende eines Arrays können mit <code>a[] = wert;</code> am Ende angehängt werden.</div>
		<h3>Beispiel 1</h3>
<pre class="code"><b>func</b> ArraySum(<b>array</b> a)
{
  <b>var</b> l = GetLength(a);
  <b>var</b> result = 0;
  <b>for</b> (<b>var</b> i = 0; i &lt; l; ++i)
  {
    result += a[i];
  }
  <b>return</b> (result);
}</pre>
		<div class="text">Diese Funktion summiert alle Elemente eines Arrays.</div>
		<h3>Beispiel 2</h3>
<pre class="code"><b>func</b> RandomID()
{
  <b>var</b> a = [CLNK, WIPF, BIRD, HUT1];
  <b>return</b> (a[Random(4)]);
}</pre>
		<div class="text">Diese Funktion wählt zufällig aus einer der vier ids aus und gibt diese zurück.</div>
	

  <h2>Maps</h2>
  
    <div class="text">
      Maps heißen in anderen Programmiersprachen auch Hashes oder assoziative Arrays.
      Maps sind nur verfügbar, wenn das Script <a href="../../sdk/script/Strict.html">#strict 3</a> oder höher ist.
      Maps können direkt mit <code>{ <em>Schlüssel 1</em> = <em>Ausdruck 1</em>, <em>Schlüssel 2</em> = <em>Ausdruck 2</em>, "<em>Schlüssel 3</em><i class="string">" = "</i><em>Ausdruck 3</em>, [<em>Schlüsselausdruck</em>] = <em>Ausdruck 4</em>, ... }</code> erstellt werden.
      Zur einfacheren zukünftigen Weiterbearbeitung ist es erlaubt, auch nach dem letzten Schlüssel-Wert-Paar ein Komma stehen zu lassen.
      Eine leere Map wird mit <code>{}</code> erstellt.
      Falls der Schlüssel Leerzeichen oder andere in Identifiern nicht erlaubte Zeichen beinhalten soll, muss er wie ein richtiger String in "" (Anführungszeichen) stehen, ansonsten sind die Anführungszeichen optional. Um das Ergebnis eines Ausdrucks oder einen Wert der kein String ist als Schlüssel zu verwenden, kann ein Ausdruck in <code>[]</code> stehen (siehe Beispiel).
    </div>
    <div class="text">
      Zum Abfragen und Setzen von Werten wird die Syntax <code><b>map</b>[key]</code> verwendet.
      Für String-Schlüssel die fest sind und nur Identifier-Zeichen beinhalten kann auch über <code><b>map</b>.key</code> (ohne Anführungszeichen), statt <code><b>map</b>[<i class="string">"key"</i>]</code> zugegriffen werden.
      Um einen Schlüssel aus einer Map zu löschen muss der Wert auf <code>nil</code> gesetzt werden.
    </div>
    <div class="text">
      Wird eine Map einer Variablen zugewiesen oder einer Funktion übergeben, bekommt diese Variable eine eigene Kopie der Map. Das eigentliche Kopieren wird aber erst ausgeführt, wenn es nötig ist. Wenn die Map einer Funktion zum Ändern übergeben werden soll, muss ein Referenzparameter verwendet werden.
    </div>
    <div class="text">
      Mithilfe einer speziellen Form von <a href="../../sdk/script/for.html#Mapschleife">for</a>-Schleife können die Schlüssel-Wert-Paare einer Map durchiteriert werden.
      Mit <a href="../../sdk/script/fn/GetKeys.html">GetKeys</a> und <a href="../../sdk/script/fn/GetValues.html">GetValues</a> können die gesetzten Schlüssel bzw. Werte einer Map als Array ermittelt werden.

      Maps sind intern mithilfe eines Hashes implementiert. Um aber die Synchronisation im Netzwerkmodus sicherzustellen, wird zusätzlich die Einfügereihenfolge der Schlüssel gespeichert.
      Die Reihenfolge der Werte in den zurückgegebenen Arrays von GetValues und GetKeys und die Iterierreihenfolge entsprechen deshalb der Einfügereihenfolge.
      Mit Einfügereihenfolge ist hier gemeint, mit welcher Reihenfolge ein Schlüssel, eventuell nach Löschen des Schlüssels, das erste mal in der Map gesetzt wird.
    </div>
    <h3>Achtung</h3>
    <div class="text">
      Wird ein Objekt direkt als Schlüssel verwendet und das Objekt wird währenddessen gelöscht, so wird der zugehörige Wert aus der Map entfernt.

      Wird hingegen ein Objekt beliebig verschachtelt in einer Map oder einem Array verwendet und wird währenddessen gelöscht, kann auf den darunter gespeicherten Wert nicht mehr zugegriffen werden. Löschen dieses Wertes ist ebenfalls nicht mehr möglich. Nur durch neu setzen der ganzen Map kann ein derartiger Zustand beseitigt werden.
    </div>
    <h3>Beispiel 1</h3>
<pre class="code"><b>func</b> MapPlayground(<b>int</b> plr)
{
  <b>var</b> clonk = <a href="../../sdk/script/fn/GetCursor.html">GetCursor</a>(plr);
  <b>var</b> m = {
    Position = { X = <a href="../../sdk/script/fn/GetX.html">GetX</a>(clonk), Y = <a href="../../sdk/script/fn/GetY.html">GetY</a>(clonk) },
    Name = <a href="../../sdk/script/fn/GetName.html">GetName</a>(clonk),
    Contents = {},
    <i class="string">"Player's Name"</i> = <a href="../../sdk/script/fn/GetPlayerName.html">GetPlayerName</a>(plr),
  };

  <a href="../../sdk/script/fn/Log.html">Log</a>(<i class="string">"Der Clonk von %s heißt %s und befindet sich bei Position %v."</i>, m[<i class="string">"Player's Name"</i>], m.Name, m.Position);

  <b>var</b> flint = clonk-&gt;<a href="../../sdk/script/fn/CreateContents.html">CreateContents</a>(FLNT);
  <b>var</b> rock = clonk-&gt;<a href="../../sdk/script/fn/CreateContents.html">CreateContents</a>(ROCK);

  m.Contents[0] = flint;
  m.Contents[1] = rock;

  m.Contents[FLNT] = flint;
  m.Contents[ROCK] = rock;

  <a href="../../sdk/script/fn/Log.html">Log</a>(<i class="string">"%v"</i>, m);

  m.Contents[FLNT] = <b>nil</b>;

  <a href="../../sdk/script/fn/Log.html">Log</a>(<i class="string">"Contents: %v"</i>, m.Contents);
}</pre>
    <div class="text">Diese Funktion demonstriert den Umgang mit Maps.</div>
    <h3>Beispiel 2</h3>
<pre class="code">
<b>#strict</b> 3

<b>local</b> discounts;

<b>func</b> Initialize()
{
  discounts = {
    <i>// [discount in %, pieces left], could also be maps, but would be more writing effort :p
</i>    [CLNK] = [10, 3],
    [EFLN] = [25, 4],
    [WOOD] = [50, 50],
    [<a href="../../sdk/script/fn/GetID.html">GetID</a>(<a href="../../sdk/script/fn/GetCursor.html">GetCursor</a>(0))] = [5, 1],
    <i>// ...
</i>  };
}

<b>func</b> GetDiscount(<b>id</b> ID)
{
  <b>return</b> discounts[ID]?[0] || 0;
}

<b>func</b> SoldItem(<b>id</b> ID)
{
  <b>if</b>(discounts[ID])
  {
    <b>if</b>(--discounts[ID][1] == 0)
    {
      discounts[ID] = <b>nil</b>;
    }
  }
}
</pre>
    <div class="text">Teil eines Objektscripts, das mithilfe einer Map für eine begrenzte Anzahl diverser Artikel Rabatte verwaltet.</div>
  

	<h2>Konvertierung</h2>

	<div class="text">Aus folgender Tabelle kann entnommen werden, welche Typen automatisch konvertiert werden und wo ein Fehler ausgelöst wird:</div>
	<div class="text"><table>
<thead><tr>
<th>nach -&gt;</th>
<th><code>int</code></th>
<th><code>bool</code></th>
<th><code>id</code></th>
<th><code>object</code></th>
<th><code>string</code></th>
<th><code>array</code></th>
<th><code>map</code></th>
</tr></thead>
<tbody>
<tr>
<td><code>int</code></td>
<td>OK</td>
<td>OK</td>
<td>if &lt;= 9999</td>
<td>Error</td>
<td>Error</td>
<td>Error</td>
<td>Error</td>
</tr>
<tr class="dark">
<td><code>bool</code></td>
<td>OK</td>
<td>OK</td>
<td>Error</td>
<td>Error</td>
<td>Error</td>
<td>Error</td>
<td>Error</td>
</tr>
<tr>
<td><code>id</code></td>
<td>#strict</td>
<td>OK</td>
<td>OK</td>
<td>Error</td>
<td>Error</td>
<td>Error</td>
<td>Error</td>
</tr>
<tr class="dark">
<td><code>object</code></td>
<td>#strict</td>
<td>OK</td>
<td>Error</td>
<td>OK</td>
<td>Error</td>
<td>Error</td>
<td>Error</td>
</tr>
<tr>
<td><code>string</code></td>
<td>#strict</td>
<td>OK</td>
<td>Error</td>
<td>Error</td>
<td>OK</td>
<td>Error</td>
<td>Error</td>
</tr>
<tr class="dark">
<td><code>array</code></td>
<td>Error</td>
<td>OK</td>
<td>Error</td>
<td>Error</td>
<td>Error</td>
<td>OK</td>
<td>Error</td>
</tr>
<tr>
<td><code>map</code></td>
<td>Error</td>
<td>OK</td>
<td>Error</td>
<td>Error</td>
<td>Error</td>
<td>Error</td>
<td>OK</td>
</tr>
</tbody>
</table></div>

	<h2>Erklärung der Tabelle:</h2>
	<div class="text"><ul>
		<li>Wo #strict steht, wird nur ein Fehler ausgelöst wenn der Script <a href="../../sdk/script/Strict.html">#strict</a> ist. Hierbei handelt es sich um "ungefährliche" aber sinnlose Konvertierungen, die nur in einigen "trickreichen" Scripts zur Anwendung kamen.</li>
		<li>Die Konvertierung int zu id ist nur erlaubt, wenn die Zahl größer gleich 0 und kleiner gleich 9999 ist. Auf diese Weise werden auch IDs, die nur aus Zahlen bestehen, unterstützt (z.B. 0001)</li>
		<li>Konvertierung nach bool ist generell erlaubt. Sie ergibt für jeden Wert außer 0 <code>true</code>.</li>
	</ul></div>



<div class="author">Günther, April 2006</div>
<div class="author">PeterW, April 2006</div>

<?php 
  pwn_body(basename (dirname(__FILE__)) . basename(__FILE__,".html"), $_SERVER['SCRIPT_NAME']);
?><ul class="nav">
<li class="fineprint">Clonk Entwicklermodus Dokumentation</li>
<li class="switchlang"><a href="javascript:switchLanguage()"><img src="/deco/dco_en_sml.gif" alt="English" border="0"></a></li>
<li><a href="../../sdk/index.html">Einleitung</a></li>
<li><a href="../../content.html">Inhalt</a></li>
<li><a href="../../search.php">Suche</a></li>
<li><a href="../../sdk/console.html">Engine</a></li>
<li><a href="../../sdk/cmdline.html">Kommandozeile</a></li>
<li><a href="../../sdk/files.html">Spieldaten</a></li>
<li><a href="../../sdk/script/index.html">Script</a></li>
</ul>
</body>
</html>
