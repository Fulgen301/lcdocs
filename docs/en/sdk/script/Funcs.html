<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<link rel="stylesheet" type="text/css" href="../../doku.css">
<title>Functions</title>
<?php 
  $g_page_language = 'english';
  require_once('../../../webnotes/core/api.php');
  pwn_head();
?><script type="text/javascript">
  function switchLanguage() {
    var loc = window.location.href;
    if (loc.match(/\/en\//)) loc = loc.replace(/\/en\//, "/de/");
    else loc = loc.replace(/\/de\//, "/en/");
    window.location = loc;
  }
</script>
</head>
<body>
<ul class="nav">
<li class="fineprint">Clonk Developer Mode Documentation</li>
<li class="switchlang"><a href="javascript:switchLanguage()"><img src="/deco/dco_de_sml.gif" alt="German" border="0"></a></li>
<li><a href="../../sdk/index.html">Introduction</a></li>
<li><a href="../../content.html">Contents</a></li>
<li><a href="../../search.php">Search</a></li>
<li><a href="../../sdk/console.html">Engine</a></li>
<li><a href="../../sdk/cmdline.html">Command Line</a></li>
<li><a href="../../sdk/files.html">Game Data</a></li>
<li><a href="../../sdk/script/index.html">Script</a></li>
</ul>


<h1>Functions</h1>

	<div class="text">A script function represents a length of script code which can be called (or executed) from the engine or from other places in script. Basically, all scripting of a scenario or object is organized in functions.</div>
	
	<h2>Parameters and Return Values</h2>
	<div class="text">Up to ten parameters can be passed in a function call. These are values which can then be used inside function execution. On completion, a function can pass a single value (the return value) back to the caller using the <a href="../../sdk/script/fn/return.html">return</a>() command.</div>
	
	<h2>Syntax</h2>
	<div class="text">A simple function declaration could look like the following:</div>
	
	<pre class="code"><b>func</b> MeineFunktion()
{
  <a href="../../sdk/script/fn/Message.html">Message</a>(<i class="string">"Meine Funktion wurde aufgerufen!"</i>);
}</pre>	

	<div class="text">A function script is delimited by { } brackets. Preceding this script block is the <strong>function declaration</strong>. The declaration starts with "<code>func</code>", followed by the <strong>function name</strong> (here: "MeineFunktion"). In the ( ) brackets following the function name the <strong>function parameters</strong> can be declared (see below).</div>
	<div class="text">When calling this function the message "Meine Funktion wurde aufgerufen!" is displayed.</div>
	
	<pre class="code"><b>func</b> ZeigeZahl(<b>int</b> zahl)
{
  <a href="../../sdk/script/fn/Message.html">Message</a>(<i class="string">"ZeigeZahl wurde mit dem Parameter %d aufgerufen!"</i>, 0, zahl);
}</pre>
	
	<div class="text">Here, a parameter with the name "zahl" of type "int" is declared. When this function is called with a parameter, "zahl" will contain the value passed. In this example, the passed value is displayed within a message.</div>
	<div class="text">A call to the function "ZeigeZahl" could look like the following:</div>
	
	<pre class="code">ZeigeZahl(42)</pre>
	
	<div class="text">Performing this call example will have the message "ZeigeZahl wurde mit dem Parameter 42 aufgerufen!" displayed.</div>
	<div class="text">In this example, multiple parameters are declared:</div>
	
	<pre class="code"><b>func</b> ZeigeSumme(zahl1, zahl2, zahl3, zahl4)
{
  <a href="../../sdk/script/fn/Message.html">Message</a>(<i class="string">"Die Summe der ersten 4 Parameter ist %d."</i>, 0, zahl1 + zahl2 + zahl3 + zahl4);
}</pre>
	
	<div class="text">There are four parameters with the names "zahl1" through "zahl4", separated by comma.</div>
	<div class="text">The message displays the sum of the four values passed. The call</div>
	
	<pre class="code">ZeigeSumme(1, 2, 3, 4);</pre>
	
	<div class="text">will result in the message "Die Summe der ersten 4 Parameter ist 10.".</div>
	
	<h2 id="parametertypen">Parameter Types</h2>
	<div class="text">You can specify the data type that is to be accepted for a given parameter. To do this, simply write the desired <a href="../../sdk/script/Typechecks.html">type name</a> before the parameter name:</div>
	
	<pre class="code"><b>func</b> TypParameterFunktion(<b>object</b> clnk, <b>id</b> def, <b>int</b> anzahl, <b>string</b> msg)
{
  <a href="../../sdk/for.html">for</a>(<b>var</b> i = 0; i &lt; anzahl; i++)
    <a href="../../sdk/script/fn/CreateContents.html">CreateContents</a>(def, clnk);
  <a href="../../sdk/script/fn/Message.html">Message</a>(msg, clnk);
}</pre>
	
	<div class="text">This functions creates a given number of a given type of objects inside the specified clonk and displays a variable message above his head. The function declaration ensures that only those values will be accepted that can be converted to the declared parameter types (see also <a href="../../sdk/script/Typechecks.html">type checking</a>).</div>
	<div class="text">Making a call such as <code>TypParameterFunktion(1, CLNK, <i class="string">"Text"</i>, 5)</code> would cause a type checking error.</div>
	
	<h2 id="spezial">Default Parameters</h2>
	<div class="text">Unlike in other programming languages you can always pass fewer parameters than are declared in a function declaration.</div>
	<div class="text">The following calls to above function are perfectly legal:</div>
	
	<pre class="code">ZeigeSumme(1, 2);
ZeigeSumme(1, 2, 3, 4, 5, 6);</pre>
	
	<div class="text">In the first call, there are fewer parameters passed to the function than specified in the function declaration. The 'missing' parameters will simply contain the value 0.</div>
	<div class="text">If you leave out a parameter it will be the same as passing the value 0.</div>
	<div class="text">In the second call, on the other hand, there are <em>more</em> parameters passed than specified. These are simply not used during function execution. However, a function is still able to access these extra parameters even if they weren't declared in the function declaration: to do this, you can use the <a href="../../sdk/script/fn/Par.html">Par</a>() function.</div>
	
	<h2>Return Values</h2>
	
		<div class="text">Every script function can pass a return value back to the caller. This is done using the <a href="../../sdk/script/fn/return.html">return</a>() function.</div>

		<h3>Example:</h3>
		
		<pre class="code"><b>func</b> Differenz(Zahl1, Zahl2)
{
  <a href="../../sdk/script/fn/return.html">return</a>(<a href="../../sdk/script/fn/Abs.html">Abs</a>(Zahl1 - Zahl2));
}</pre>
	
		<div class="text">Here the difference of the two passed parameters is calculated and the result is "returned". The calling script could now use this function to calculate the difference of any two numbers:</div>
		
		<pre class="code"><b>func</b> ZeigeDifferenz(Zahl1, Zahl2)
{
  <a href="../../sdk/script/fn/Message.html">Message</a>(<i class="string">"Die Differenz zwischen %d und %d beträgt %d!"</i>, Zahl1, Zahl2, Differenz(Zahl1, Zahl2));
}	</pre>
	
		<div class="text">The call "ZeigeDifferenz(5, 2)" will produce the message "Die Differenz zwischen 5 und 2 beträgt 3!".</div>
	
	
	<h2 id="Aufrufb">Permissions</h2>
	
		<div class="text">A function can have one of three levels of "calling permission". This will determine from where the function may be called:</div>	
	
		<div class="text"><table><tbody>
<tr>
<td><code>public</code></td>
<td>may be called from the engine or any other script (default)</td>
</tr>
<tr class="dark">
<td><code>protected</code></td>
<td>may only be called from the engine or from within the same object script</td>
</tr>
<tr>
<td><code>private</code></td>
<td>may only be called from the same object script</td>
</tr>
</tbody></table></div>
		
		<div class="text">The calling permissions are expected before the <code>func</code> marker:</div>
		
<pre class="code"><b>private</b> <b>func</b> PrivateFunktion()
{
  <i>// Diese Funktion darf nur im selben Script aufgerufen werden!
</i>}</pre>
	
		<div class="text">Calling this function from another object script will cause an error.</div>
		
		<h3>Remark</h3> 
		<div class="text">As in some cases it may seem necessary to call a protected function from another object script, there is a workaround through the <a href="../../sdk/script/fn/PrivateCall.html">PrivateCall</a> and <a href="../../sdk/script/fn/ProtectedCall.html">ProtectedCall</a> functions.</div>
	
	
	<h2>Global Functions</h2>
	
		<div class="text">A function is declared globally by placing the "<code>global</code>" keyword before the <code>func</code> marker.</div>
		<div class="text">A <code>global</code> function can be called from any script. Its scope corresponds to that of the predefined engine functions. Global script functions can also be used to overload predefined engine functions in order to change their behaviour.</div>
		
		<h3>Example:</h3>

<pre class="code"><b>global</b> <b>func</b> CreateContents(<b>id</b>, pObj, iCnt)
{
  <b>var</b> pObj;
  <a href="../../sdk/for.html">for</a>(<b>var</b> i = 0; i &lt; iCnt; i++)
    pObj = <a href="../../sdk/script/fn/inherited.html">inherited</a>(<b>id</b>, pObj);
  <b>return</b>(pObj);
}</pre>
	
		<div class="text">This script redefines the engine function <a href="../../sdk/script/fn/CreateContents.html">CreateContents</a> while adding a new parameter declaration at the end of the parameter list which now allows to create multiple objects. Notice that <a href="../../sdk/script/fn/inherited.html">inherited</a> within this function refers to the overloaded engine function <a href="../../sdk/script/fn/CreateContents.html">CreateContents</a>!</div>
		
		<h3>Attention!</h3>
		<div class="text">A global script function is executed with the context of the calling function. This means in particular that <a href="../../sdk/script/fn/this.html">this</a>() is the calling object (if the global function was called from an object local scope). Because of this, a global function may not use any object local variables or try to call any object local function. The following object script is illegal:</div>
		
		<pre class="code"><b>local</b> iNummer;
<b>func</b> ObjektFunktion()
{
  <a href="../../sdk/script/fn/Log.html">Log</a>(<i class="string">"ObjectFunktion: local iNummer hat den Wert %d!"</i>, iNummer);
}

<b>global</b> <b>func</b> GlobaleFunktion()
{
  ObjectFunktion(); <i>// Fehler!
</i>  iNummer++; <i>// Fehler!
</i>}</pre>
		
		<div class="text">Both attempts to access the object local elements will fail. This is understandable because the globally declared function may have been called from any script, even from a scenario script or the script of another object. It will thus not know the declared variable or object function. As the calling context can't be safely known, the engine will throw an error.</div>
		<div class="text">Notice: to call an object local function from a different context, use the syntax "<code>this()-&gt;function(...)</code>". This will execute the function in the specified object's context and only cause an error if the function really isn't available.</div>
	
	
	<h2 id="referenzen">References</h2>
	<div class="text">In some cases, you don't want to pass the value of a variable as a parameter, but the "variable itself" so the function that is called can modify the original variable. This is done by passing a "reference" to the variable as parameter.</div>
	<div class="text">Let's say we want to write a function that returns the position (coordinates) of the player's clonk with the highest rank. This cannot be done with a single return value, as we need to return x and a coordinates.</div>
	<div class="text">By using references as parameters this can be achieved:</div>
	
	<pre class="code"><b>func</b> GetHiRankPosition(<b>int</b> plr, &amp;x, &amp;y)
{
  <b>var</b> oHiRank = <a href="../../sdk/script/fn/GetHiRank.html">GetHiRank</a>(plr);
  x = <a href="../../sdk/script/fn/GetX.html">GetX</a>(oHiRank);
  y = <a href="../../sdk/script/fn/GetY.html">GetY</a>(oHiRank);
}

<b>func</b> Aufruf()
{
  <b>var</b> iHiRankX, iHiRankY;
  GetHiRankPosition(0, iHiRankX, iHiRankY);
  <a href="../../sdk/script/fn/Message.html">Message</a>(<i class="string">"Die Position des HiRanks von Spieler 1 ist: %d/%d"</i>, 0, iHiRankX, iHiRankY);
}</pre>
	
	<div class="text">
<code>x</code> and <code>y</code> in <code>GetHiRankPosition</code> are <strong>references</strong>, meaning when the called function modifies these values, the original variables (<code>iHiRankX</code> and <code>iHiRankY</code>) will be modified and the calling code will have the modified values. Notice, however, that you <em>have</em> to specify true variables as parameters for references. You cannot make a call such as "<code>GetHiRankPosition(0, iHiRankX + 1, iHiRankY)</code>" as in this case "<code>iHiRankX + 1</code>" is not a variable but a numeric result!</div>
	<div class="text">Notice that in C4Script "<code>&amp;</code>" is a data type of its own. You may not specify an extra data type with it, such as in "<code><b>int</b> &amp;x</code>"!</div>


<div class="author">PeterW, Juli 2002</div>
<div class="author">matthes, Juni 2004</div>

<?php 
  pwn_body(basename (dirname(__FILE__)) . basename(__FILE__,".html"), $_SERVER['SCRIPT_NAME']);
?><ul class="nav">
<li class="fineprint">Clonk Developer Mode Documentation</li>
<li class="switchlang"><a href="javascript:switchLanguage()"><img src="/deco/dco_de_sml.gif" alt="German" border="0"></a></li>
<li><a href="../../sdk/index.html">Introduction</a></li>
<li><a href="../../content.html">Contents</a></li>
<li><a href="../../search.php">Search</a></li>
<li><a href="../../sdk/console.html">Engine</a></li>
<li><a href="../../sdk/cmdline.html">Command Line</a></li>
<li><a href="../../sdk/files.html">Game Data</a></li>
<li><a href="../../sdk/script/index.html">Script</a></li>
</ul>
</body>
</html>
